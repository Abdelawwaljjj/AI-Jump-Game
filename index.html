<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>City Jump</title>
    <style>
        body {
            margin: 0;
            overflow: hidden;
            font-family: 'Arial', sans-serif;
            background-color: #000;
            -webkit-touch-callout: none;
            -webkit-user-select: none;
            -webkit-tap-highlight-color: rgba(0, 0, 0, 0);
        }

        .parallax-bg {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: url('background.png') repeat;
            background-size: cover;
            z-index: -2;
            animation: parallaxScroll 20s linear infinite;
        }

        @keyframes parallaxScroll {
            from {
                background-position: 0 0;
            }
            to {
                background-position: -1000px 0;
            }
        }

        .menu {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            width: 100%;
            flex-direction: column;
            text-align: center;
            z-index: 1;
        }

        .menu-content {
            background-color: rgba(0, 0, 0, 0.7);
            padding: 40px;
            border-radius: 20px;
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.6);
            max-width: 90%;
            width: 350px;
        }

        .title {
            font-size: 50px;
            margin-bottom: 30px;
            color: #ffdd59;
            text-shadow: 0 0 20px rgba(255, 221, 89, 0.7), 0 0 30px rgba(255, 221, 89, 0.5);
            animation: fadeIn 1.5s ease-out;
        }

        @keyframes fadeIn {
            0% { opacity: 0; transform: translateY(-20px); }
            100% { opacity: 1; transform: translateY(0); }
        }

        .neon-button {
            width: 100%;
            padding: 15px;
            margin: 15px 0;
            font-size: 22px;
            cursor: pointer;
            background: #111;
            color: white;
            border: none;
            border-radius: 5px;
            text-transform: uppercase;
            letter-spacing: 2px;
            position: relative;
            transition: color 0.3s;
            overflow: hidden;
        }

        .neon-button:hover {
            color: #ff5733;
            box-shadow: 0 0 15px rgba(255, 87, 51, 0.5), 0 0 30px rgba(255, 87, 51, 0.3);
            text-shadow: 0 0 5px rgba(255, 87, 51, 0.8), 0 0 10px rgba(255, 87, 51, 0.6);
        }

        .chat-bar {
            background-color: black;
            color: white;
            font-weight: bold;
            padding: 20px;
            border-radius: 10px;
            border: 2px solid white;
            position: fixed;
            width: 90%;
            max-width: 600px;
            box-sizing: border-box;
            z-index: 10;
            overflow-y: auto;
            max-height: 80%;
        }

        #instructionBar {
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
        }

        #exitMessage {
            top: 10%;
            left: 50%;
            transform: translateX(-50%);
            display: none;
            text-align: center;
        }

        .close-btn {
            position: absolute;
            top: 10px;
            right: 10px;
            width: 20px;
            height: 20px;
            background-color: red;
            border-radius: 50%;
            color: white;
            text-align: center;
            line-height: 18px;
            cursor: pointer;
            font-weight: bold;
        }

        canvas {
            display: none;
            width: 100%;
            height: 100%;
            touch-action: none;
            z-index: 0;
        }

        #introVideo {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 2;
            background-color: black;
            display: none;
        }
    </style>
</head>
<body>
    <div class="parallax-bg"></div>
    <div id="mainMenu" class="menu">
        <div class="menu-content">
            <h1 class="title">City Jump</h1>
            <button id="startGameButton" class="menu-button neon-button">Start Game</button>
            <button id="instructionsButton" class="menu-button neon-button">Instructions</button>
            <button id="exitButton" class="menu-button neon-button">Exit</button>

            <div id="instructionBar" class="chat-bar">
                <div class="close-btn" onclick="closeInstructionBar()">x</div>
                <p>In City Jump, your goal is to collect as many coins as possible without falling into the lava. The longer you run, the faster your character will become, making it harder to land on platforms.</p>
                <!-- Additional instructions omitted for brevity -->
            </div>

            <div id="exitMessage" class="chat-bar">
                <div class="close-btn" onclick="closeExitMessage()">x</div>
                Exit functionality is not supported on this platform. Close the app manually.
            </div>
        </div>
    </div>
    
    <video id="introVideo" src="intro-video.mp4"></video>
    <canvas id="gameCanvas"></canvas>
    
    <audio id="backgroundMusic" loop>
        <source src="background-music.mp3" type="audio/mpeg">
        Your browser does not support the audio element.
    </audio>

    <script>
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');

        const mainMenu = document.getElementById('mainMenu');
        const startGameButton = document.getElementById('startGameButton');
        const instructionsButton = document.getElementById('instructionsButton');
        const exitButton = document.getElementById('exitButton');
        const backgroundMusic = document.getElementById('backgroundMusic');
        const introVideo = document.getElementById('introVideo');

        const instructionBar = document.getElementById('instructionBar');
        const exitMessage = document.getElementById('exitMessage');

        function resizeCanvas() {
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
        }

        window.addEventListener('resize', resizeCanvas);
        resizeCanvas();

        let gameOver = false;
        let highScore = 0;
        let lastTapTime = 0;
        let animationFrame = 0;

        const images = {
            background: new Image(),
            character1: new Image(),
            character2: new Image(),
            floor: new Image(),
            explosion: new Image(),
        };

        images.background.src = 'gamebackground2.png';
        images.character1.src = 'character1.png';
        images.character2.src = 'character2.png';
        images.floor.src = 'lavafloor.png';
        images.explosion.src = 'T-fireexplosion.png';

        const camera = { x: 0, y: 0, width: canvas.width, height: canvas.height };
        const player = {
            x: 50,
            y: canvas.height - 200,
            width: 30,
            height: 50,
            velocityX: 0,
            velocityY: 0,
            isJumping: false,
            speed: 4,
            jumpHeight: 14,
            score: 0,
            currentImage: images.character1,
            explosionCounter: 0,
        };

        const platforms = [];
        const coins = [];

        function setPlayerPositionOnPlatform(platform) {
            player.x = platform.x;
            player.y = platform.y - player.height;
        }

        class Platform {
            constructor(x, y, width, height, color, isLava = false) {
                this.x = x;
                this.y = y;
                this.width = width;
                this.height = height;
                this.color = color;
                this.isLava = isLava;
            }

            draw() {
                ctx.fillStyle = this.color;
                ctx.fillRect(this.x - camera.x, this.y, this.width, this.height);
                ctx.strokeStyle = this.isLava ? 'red' : 'white';
                ctx.lineWidth = 2;
                ctx.strokeRect(this.x - camera.x, this.y, this.width, this.height);
            }
        }

        class Coin {
            constructor(x, y, radius, color) {
                this.x = x;
                this.y = y;
                this.radius = radius;
                this.color = color;
                this.rotation = 0;
            }

            draw() {
                this.rotation += 0.1;
                if (this.rotation >= Math.PI * 2) this.rotation = 0;
                const currentWidth = this.radius * (1 - 0.5 * Math.abs(Math.sin(this.rotation)));
                ctx.fillStyle = this.color;
                ctx.beginPath();
                ctx.ellipse(this.x - camera.x, this.y, currentWidth, this.radius, 0, 0, Math.PI * 2);
                ctx.fill();
            }
        }

        function getRandomColor() {
            const letters = '0123456789ABCDEF';
            let color = '#';
            for (let i = 0; i < 6; i++) {
                color += letters[Math.floor(Math.random() * 16)];
            }
            return color;
        }

        function generatePlatforms() {
            if (platforms.length === 0 || platforms[platforms.length - 1].x - camera.x < canvas.width - 200) {
                const platformWidth = 200;
                const platformHeight = 20;
                const platformColor = getRandomColor();
                let minHeight = canvas.height / 2;
                let maxHeight = canvas.height - 150;
                const minGap = 50;
                const maxGap = 200;
                const randomGap = Math.floor(Math.random() * (maxGap - minGap + 1) + minGap);
                const xPos = platforms.length === 0 ? player.x + randomGap : platforms[platforms.length - 1].x + platformWidth + randomGap;

                let yPos;
                if (platforms.length === 0) {
                    yPos = player.y;
                } else {
                    const lastPlatformHeight = platforms[platforms.length - 1].y;
                    const reachableMinHeight = Math.max(minHeight, lastPlatformHeight - player.jumpHeight * 2);
                    const reachableMaxHeight = Math.min(maxHeight, lastPlatformHeight + player.jumpHeight * 2);
                    yPos = Math.floor(Math.random() * (reachableMaxHeight - reachableMinHeight + 1) + reachableMinHeight);
                }

                const isLava = Math.random() < 0.2;  // 20% chance to be a lava platform
                const platform = new Platform(xPos, yPos, platformWidth, platformHeight, platformColor, isLava);
                platforms.push(platform);

                if (!isLava) generateCoins(platform);
                if (platforms.length === 1) setPlayerPositionOnPlatform(platform);
            }
        }

        function generateCoins(platform) {
            if (!platform.isLava) {
                const numberOfCoins = Math.floor(Math.random() * 4) + 1;
                const coinSpacing = platform.width / (numberOfCoins + 1);
                for (let i = 0; i < numberOfCoins; i++) {
                    const coinX = platform.x + coinSpacing * (i + 1);
                    const coinY = platform.y - 25;
                    coins.push(new Coin(coinX, coinY, 10, 'gold'));
                }
            }
        }

        function handlePlayerMovement() {
            player.x += player.speed;
            player.velocityX = player.speed;
            player.speed += 0.00005;  // Increase speed over time
        }

        function handlePlayerVerticalMovement() {
            player.velocityY += 0.5;
            player.y += player.velocityY;

            let onPlatform = false;
            platforms.forEach((platform) => {
                if (
                    player.x < platform.x + platform.width &&
                    player.x + player.width > platform.x &&
                    player.y + player.height >= platform.y - 5 &&
                    player.y + player.height <= platform.y + platform.height &&
                    !platform.isLava
                ) {
                    onPlatform = true;
                    player.y = platform.y - player.height;
                    player.velocityY = 0;
                }
            });

            const floorHeight = 50;
            if (player.y + player.height >= canvas.height - floorHeight) {
                onPlatform = true;
                player.y = canvas.height - player.height - floorHeight;
                player.velocityY = 0;
            }

            player.isJumping = !onPlatform;
        }

        function detectCollisions() {
            coins.forEach((coin, index) => {
                const playerCenterX = player.x + player.width / 2;
                const playerCenterY = player.y + player.height / 2;
                const distance = Math.sqrt((playerCenterX - coin.x) ** 2 + (playerCenterY - coin.y) ** 2);
                if (distance < player.width / 2 + coin.radius) {
                    player.score += 1;
                    coins.splice(index, 1);
                }
            });

            platforms.forEach((platform) => {
                if (platform.isLava && player.x > platform.x && player.x < platform.x + platform.width) {
                    gameOver = true;
                }
            });

            if (player.y + player.height >= canvas.height) {
                gameOver = true;
            }
        }

        function update() {
            if (!gameOver) {
                handlePlayerMovement();
                handlePlayerVerticalMovement();
                detectCollisions();
                camera.x = player.x - camera.width / 2;
                generatePlatforms();

                if (player.x > highScore) highScore = player.x;
            } else {
                updateHighScore();
            }
        }

        function draw() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);

            ctx.drawImage(images.background, 0, 0, canvas.width, canvas.height);

            platforms.forEach(platform => platform.draw());
            coins.forEach(coin => coin.draw());

            const characterWidth = player.width;
            const characterHeight = player.height;
            ctx.drawImage(player.currentImage, player.x - camera.x, player.y, characterWidth, characterHeight);

            ctx.fillStyle = 'white';
            ctx.font = '20px Arial';
            ctx.fillText(`Score: ${player.score}`, 20, 40);
            ctx.fillText(`High Score: ${Math.floor(highScore)}`, 20, 80);

            if (gameOver) {
                ctx.fillStyle = 'red';
                ctx.font = '50px Arial';
                ctx.fillText('Game Over', canvas.width / 2 - 150, canvas.height / 2 - 20);
                ctx.font = '30px Arial';
                ctx.fillText('Click to Restart', canvas.width / 2 - 130, canvas.height / 2 + 50);
            }
        }

        function gameLoop() {
            update();
            draw();
            if (!gameOver) requestAnimationFrame(gameLoop);
        }

        function resetGame() {
            gameOver = false;
            player.x = 50;
            player.y = canvas.height - 150 - 50;
            player.velocityX = 0;
            player.velocityY = 0;
            player.score = 0;
            player.speed = 4;
            platforms.length = 0;
            coins.length = 0;
            generatePlatforms();
            requestAnimationFrame(gameLoop);
        }

        startGameButton.addEventListener('click', () => {
            mainMenu.style.display = 'none';
            canvas.style.display = 'block';
            backgroundMusic.play();
            resetGame();
        });

        canvas.addEventListener('click', (event) => {
            const currentTime = new Date().getTime();
            const timeDiff = currentTime - lastTapTime;

            if (timeDiff < 300 && !player.isJumping) {
                player.velocityY = -player.jumpHeight * 2;  // Double height jump
            } else if (!player.isJumping) {
                player.velocityY = -player.jumpHeight;
            }

            lastTapTime = currentTime;

            if (gameOver) resetGame();
        });

        instructionsButton.addEventListener('click', () => {
            instructionBar.style.display = 'block';
        });

        exitButton.addEventListener('click', () => {
            exitMessage.style.display = 'block';
        });

        function closeInstructionBar() {
            instructionBar.style.display = 'none';
        }

        function closeExitMessage() {
            exitMessage.style.display = 'none';
        }

        function updateHighScore() {
            if (player.score > highScore) {
                highScore = player.score;
                localStorage.setItem('highScore', highScore);
            }
        }

        function loadHighScore() {
            const storedHighScore = localStorage.getItem('highScore');
            if (storedHighScore !== null) highScore = parseInt(storedHighScore, 10);
        }

        window.addEventListener('load', loadHighScore);
    </script>
</body>
</html>
